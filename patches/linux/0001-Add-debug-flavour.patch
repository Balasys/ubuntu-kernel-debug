From 0e1e44e60b9dac338f96ee81a857e277da6fc54e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jakab=20Krist=C3=B3f?= <jakab.kristof@balasys.hu>
Date: Thu, 6 Oct 2016 15:58:55 +0200
Subject: [PATCH 1/4] Add debug flavour

---
 debian.xenial/config/amd64/config.flavour.debug      | 11 +++++++++++
 debian.xenial/config/amd64/config.flavour.generic    |  2 ++
 debian.xenial/config/amd64/config.flavour.lowlatency |  2 ++
 debian.xenial/config/arm64/config.common.arm64       |  2 ++
 debian.xenial/config/armhf/config.common.armhf       |  2 ++
 debian.xenial/config/config.common.ubuntu            | 10 ++++++++--
 debian.xenial/config/i386/config.common.i386         |  2 ++
 debian.xenial/config/powerpc/config.common.powerpc   |  2 ++
 debian.xenial/config/ppc64el/config.common.ppc64el   |  2 ++
 debian.xenial/config/s390x/config.common.s390x       |  2 ++
 debian.xenial/control.d/vars.debug                   |  6 ++++++
 11 files changed, 41 insertions(+), 2 deletions(-)
 create mode 100644 debian.xenial/config/amd64/config.flavour.debug
 create mode 100644 debian.xenial/control.d/vars.debug

diff --git a/debian.xenial/config/amd64/config.flavour.debug b/debian.xenial/config/amd64/config.flavour.debug
new file mode 100644
index 0000000..1f785b8
--- /dev/null
+++ b/debian.xenial/config/amd64/config.flavour.debug
@@ -0,0 +1,11 @@
+#
+# Config options for config.flavour.debug automatically generated by splitconfig.pl
+#
+CONFIG_DEBUG_KMEMLEAK=y
+CONFIG_HZ=250
+# CONFIG_HZ_1000 is not set
+CONFIG_HZ_250=y
+# CONFIG_IRQ_FORCED_THREADING_DEFAULT is not set
+CONFIG_KASAN=y
+# CONFIG_PREEMPT is not set
+CONFIG_PREEMPT_VOLUNTARY=y
diff --git a/debian.xenial/config/amd64/config.flavour.generic b/debian.xenial/config/amd64/config.flavour.generic
index 5c2e4e1..27eadb8 100644
--- a/debian.xenial/config/amd64/config.flavour.generic
+++ b/debian.xenial/config/amd64/config.flavour.generic
@@ -1,9 +1,11 @@
 #
 # Config options for config.flavour.generic automatically generated by splitconfig.pl
 #
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_HZ=250
 # CONFIG_HZ_1000 is not set
 CONFIG_HZ_250=y
 # CONFIG_IRQ_FORCED_THREADING_DEFAULT is not set
+# CONFIG_KASAN is not set
 # CONFIG_PREEMPT is not set
 CONFIG_PREEMPT_VOLUNTARY=y
diff --git a/debian.xenial/config/amd64/config.flavour.lowlatency b/debian.xenial/config/amd64/config.flavour.lowlatency
index 6b121e3..11d16dc 100644
--- a/debian.xenial/config/amd64/config.flavour.lowlatency
+++ b/debian.xenial/config/amd64/config.flavour.lowlatency
@@ -1,9 +1,11 @@
 #
 # Config options for config.flavour.lowlatency automatically generated by splitconfig.pl
 #
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_HZ=1000
 CONFIG_HZ_1000=y
 # CONFIG_HZ_250 is not set
 CONFIG_IRQ_FORCED_THREADING_DEFAULT=y
+# CONFIG_KASAN is not set
 CONFIG_PREEMPT=y
 # CONFIG_PREEMPT_VOLUNTARY is not set
diff --git a/debian.xenial/config/arm64/config.common.arm64 b/debian.xenial/config/arm64/config.common.arm64
index b7991ea..dddcd16 100644
--- a/debian.xenial/config/arm64/config.common.arm64
+++ b/debian.xenial/config/arm64/config.common.arm64
@@ -69,6 +69,7 @@ CONFIG_CRAMFS=m
 # CONFIG_CXL_BASE is not set
 # CONFIG_CXL_EEH is not set
 # CONFIG_CXL_KERNEL_API is not set
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_DECNET=m
 CONFIG_DEFAULT_MMAP_MIN_ADDR=32768
 CONFIG_DMADEVICES=y
@@ -164,6 +165,7 @@ CONFIG_JFS_FS=m
 CONFIG_JME=m
 CONFIG_JUMP_LABEL=y
 CONFIG_KARMA_PARTITION=y
+# CONFIG_KASAN is not set
 CONFIG_KVM=y
 CONFIG_LAPB=m
 CONFIG_LDM_PARTITION=y
diff --git a/debian.xenial/config/armhf/config.common.armhf b/debian.xenial/config/armhf/config.common.armhf
index f3d209b..5adcdd1 100644
--- a/debian.xenial/config/armhf/config.common.armhf
+++ b/debian.xenial/config/armhf/config.common.armhf
@@ -68,6 +68,7 @@ CONFIG_CRYPTO_DEV_FSL_CAAM_LE=y
 # CONFIG_CXL_BASE is not set
 # CONFIG_CXL_EEH is not set
 # CONFIG_CXL_KERNEL_API is not set
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_DECNET=m
 CONFIG_DEFAULT_MMAP_MIN_ADDR=32768
 CONFIG_DMADEVICES=y
@@ -154,6 +155,7 @@ CONFIG_JFS_FS=m
 CONFIG_JME=m
 # CONFIG_JUMP_LABEL is not set
 CONFIG_KARMA_PARTITION=y
+# CONFIG_KASAN is not set
 CONFIG_KERNEL_GZIP=y
 # CONFIG_KERNEL_XZ is not set
 CONFIG_KVM=y
diff --git a/debian.xenial/config/config.common.ubuntu b/debian.xenial/config/config.common.ubuntu
index 8ae7e30..4a6959f 100644
--- a/debian.xenial/config/config.common.ubuntu
+++ b/debian.xenial/config/config.common.ubuntu
@@ -1421,6 +1421,7 @@ CONFIG_COMPAT_OLD_SIGACTION=y
 CONFIG_CONNECTOR=y
 CONFIG_CONSOLE_POLL=y
 CONFIG_CONSOLE_TRANSLATIONS=y
+CONFIG_CONSTRUCTORS=y
 CONFIG_CONTEXT_SWITCH_TRACER=y
 CONFIG_COPS=m
 CONFIG_COPS_DAYNA=y
@@ -1762,7 +1763,9 @@ CONFIG_DEBUG_INFO_DWARF4=y
 # CONFIG_DEBUG_INFO_REDUCED is not set
 # CONFIG_DEBUG_INFO_SPLIT is not set
 CONFIG_DEBUG_KERNEL=y
-# CONFIG_DEBUG_KMEMLEAK is not set
+# CONFIG_DEBUG_KMEMLEAK_DEFAULT_OFF is not set
+CONFIG_DEBUG_KMEMLEAK_EARLY_LOG_SIZE=6400
+# CONFIG_DEBUG_KMEMLEAK_TEST is not set
 # CONFIG_DEBUG_KOBJECT is not set
 # CONFIG_DEBUG_LIST is not set
 # CONFIG_DEBUG_LL is not set
@@ -3969,7 +3972,9 @@ CONFIG_JSA1212=m
 CONFIG_K3_DMA=m
 CONFIG_KALLSYMS=y
 CONFIG_KALLSYMS_ALL=y
-# CONFIG_KASAN is not set
+CONFIG_KASAN_INLINE=y
+# CONFIG_KASAN_OUTLINE is not set
+CONFIG_KASAN_SHADOW_OFFSET=0xdffffc0000000000
 CONFIG_KDB_CONTINUE_CATASTROPHIC=0
 CONFIG_KDB_DEFAULT_ENABLE=0x1
 CONFIG_KDB_KEYBOARD=y
@@ -7804,6 +7809,7 @@ CONFIG_TERANETICS_PHY=m
 CONFIG_TEST_BPF=m
 CONFIG_TEST_FIRMWARE=m
 CONFIG_TEST_HEXDUMP=m
+# CONFIG_TEST_KASAN is not set
 CONFIG_TEST_KSTRTOX=m
 # CONFIG_TEST_LIST_SORT is not set
 CONFIG_TEST_LKM=m
diff --git a/debian.xenial/config/i386/config.common.i386 b/debian.xenial/config/i386/config.common.i386
index a76ea7c..3270eaf 100644
--- a/debian.xenial/config/i386/config.common.i386
+++ b/debian.xenial/config/i386/config.common.i386
@@ -66,6 +66,7 @@ CONFIG_CRASH_DUMP=y
 # CONFIG_CXL_BASE is not set
 # CONFIG_CXL_EEH is not set
 # CONFIG_CXL_KERNEL_API is not set
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_DECNET=m
 CONFIG_DEFAULT_MMAP_MIN_ADDR=65536
 CONFIG_DMADEVICES=y
@@ -156,6 +157,7 @@ CONFIG_JFS_FS=m
 CONFIG_JME=m
 CONFIG_JUMP_LABEL=y
 CONFIG_KARMA_PARTITION=y
+# CONFIG_KASAN is not set
 CONFIG_KERNEL_GZIP=y
 # CONFIG_KERNEL_XZ is not set
 CONFIG_KVM=m
diff --git a/debian.xenial/config/powerpc/config.common.powerpc b/debian.xenial/config/powerpc/config.common.powerpc
index 9522e8e..ba736d0 100644
--- a/debian.xenial/config/powerpc/config.common.powerpc
+++ b/debian.xenial/config/powerpc/config.common.powerpc
@@ -64,6 +64,7 @@ CONFIG_CPU_BIG_ENDIAN=y
 CONFIG_CRAMFS=m
 # CONFIG_CRYPTO_DEV_FSL_CAAM_IMX is not set
 # CONFIG_CRYPTO_DEV_FSL_CAAM_LE is not set
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_DECNET=m
 CONFIG_DEFAULT_MMAP_MIN_ADDR=65536
 CONFIG_DMADEVICES=y
@@ -149,6 +150,7 @@ CONFIG_JFS_FS=m
 CONFIG_JME=m
 CONFIG_JUMP_LABEL=y
 CONFIG_KARMA_PARTITION=y
+# CONFIG_KASAN is not set
 CONFIG_KVM=y
 CONFIG_LAPB=m
 CONFIG_LDM_PARTITION=y
diff --git a/debian.xenial/config/ppc64el/config.common.ppc64el b/debian.xenial/config/ppc64el/config.common.ppc64el
index 4d55656..1807006 100644
--- a/debian.xenial/config/ppc64el/config.common.ppc64el
+++ b/debian.xenial/config/ppc64el/config.common.ppc64el
@@ -70,6 +70,7 @@ CONFIG_CRASH_DUMP=y
 CONFIG_CXL_BASE=y
 CONFIG_CXL_EEH=y
 CONFIG_CXL_KERNEL_API=y
+# CONFIG_DEBUG_KMEMLEAK is not set
 CONFIG_DECNET=m
 CONFIG_DEFAULT_MMAP_MIN_ADDR=65536
 # CONFIG_DEFAULT_UIMAGE is not set
@@ -169,6 +170,7 @@ CONFIG_JFS_FS=m
 CONFIG_JME=m
 CONFIG_JUMP_LABEL=y
 CONFIG_KARMA_PARTITION=y
+# CONFIG_KASAN is not set
 CONFIG_KERNEL_START=0xc000000000000000
 CONFIG_KVM=y
 CONFIG_LAPB=m
diff --git a/debian.xenial/config/s390x/config.common.s390x b/debian.xenial/config/s390x/config.common.s390x
index 15423a5..6d308c9 100644
--- a/debian.xenial/config/s390x/config.common.s390x
+++ b/debian.xenial/config/s390x/config.common.s390x
@@ -60,6 +60,7 @@ CONFIG_CRASH_DUMP=y
 # CONFIG_CXL_BASE is not set
 # CONFIG_CXL_EEH is not set
 # CONFIG_CXL_KERNEL_API is not set
+# CONFIG_DEBUG_KMEMLEAK is not set
 # CONFIG_DECNET is not set
 CONFIG_DEFAULT_MMAP_MIN_ADDR=65536
 # CONFIG_DMADEVICES is not set
@@ -131,6 +132,7 @@ CONFIG_IP_DCCP_CCID3=y
 # CONFIG_JME is not set
 CONFIG_JUMP_LABEL=y
 # CONFIG_KARMA_PARTITION is not set
+# CONFIG_KASAN is not set
 # CONFIG_KERNEL_GZIP is not set
 CONFIG_KERNEL_XZ=y
 CONFIG_KVM=y
diff --git a/debian.xenial/control.d/vars.debug b/debian.xenial/control.d/vars.debug
new file mode 100644
index 0000000..ba5a3ea
--- /dev/null
+++ b/debian.xenial/control.d/vars.debug
@@ -0,0 +1,6 @@
+arch="amd64"
+supported="Debug"
+target="Geared toward desktop and server systems."
+desc="=HUMAN= SMP"
+bootloader="grub-pc [amd64] | grub-efi-amd64 [amd64] | grub-efi-ia32 [amd64] | grub [amd64] | lilo [amd64]"
+provides="kvm-api-4, redhat-cluster-modules, ivtv-modules, virtualbox-guest-modules [amd64]"
-- 
1.9.1

