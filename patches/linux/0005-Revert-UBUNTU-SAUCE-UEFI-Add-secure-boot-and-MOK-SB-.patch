From d9461f432ff60f5efd2facdf19220e36548335dd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jakab=20Krist=C3=B3f?= <jakab.kristof@balasys.hu>
Date: Thu, 14 Jul 2016 08:37:35 +0200
Subject: [PATCH 05/19] Revert "UBUNTU: SAUCE: UEFI: Add secure boot and MOK SB
 State disabled sysctl"

This reverts commit c6994d58e4793285a027e1b2ee6198668e488bfa.
---
 arch/x86/kernel/setup.c |  1 -
 kernel/sysctl.c         | 31 -------------------------------
 2 files changed, 32 deletions(-)

diff --git a/arch/x86/kernel/setup.c b/arch/x86/kernel/setup.c
index ecfbe54..a7d6b72 100644
--- a/arch/x86/kernel/setup.c
+++ b/arch/x86/kernel/setup.c
@@ -1167,7 +1167,6 @@ void __init setup_arch(char **cmdline_p)
 		pr_info("Secure boot enabled\n");
 	}
 	else if (boot_params.secure_boot == EFI_MOKSBSTATE_DISABLED) {
-		set_bit(EFI_MOKSBSTATE_DISABLED, &efi.flags);
 		boot_params.secure_boot = 0;
 		pr_info("Secure boot MOKSBState disabled\n");
     }
diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 318cef7..7c854cb 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -64,7 +64,6 @@
 #include <linux/binfmts.h>
 #include <linux/sched/sysctl.h>
 #include <linux/kexec.h>
-#include <linux/efi.h>
 
 #include <asm/uaccess.h>
 #include <asm/processor.h>
@@ -279,38 +278,8 @@ static int min_extfrag_threshold;
 static int max_extfrag_threshold = 1000;
 #endif
 
-static unsigned int secure_boot_enabled;
-int secure_boot_proc_handler(struct ctl_table *table, int write,
-	void __user *buffer, size_t *lenp, loff_t *ppos)
-{
-	secure_boot_enabled = efi_enabled(EFI_SECURE_BOOT);
-	return proc_dointvec(table, write, buffer, lenp, ppos);
-}
-
-static unsigned int moksbstate_disabled;
-int moksbstate_disabled_proc_handler(struct ctl_table *table, int write,
-	void __user *buffer, size_t *lenp, loff_t *ppos)
-{
-	moksbstate_disabled = efi_enabled(EFI_MOKSBSTATE_DISABLED);
-	return proc_dointvec(table, write, buffer, lenp, ppos);
-}
-
 static struct ctl_table kern_table[] = {
 	{
-		.procname   = "secure_boot",
-		.data       = &secure_boot_enabled,
-		.maxlen     = sizeof(unsigned int),
-		.mode       = 0444,
-		.proc_handler   = secure_boot_proc_handler,
-	},
-	{
-		.procname   = "moksbstate_disabled",
-		.data       = &moksbstate_disabled,
-		.maxlen     = sizeof(unsigned int),
-		.mode       = 0444,
-		.proc_handler   = moksbstate_disabled_proc_handler,
-	},
-	{
 		.procname	= "sched_child_runs_first",
 		.data		= &sysctl_sched_child_runs_first,
 		.maxlen		= sizeof(unsigned int),
-- 
2.9.2

